{% extends 'layout.html' %}

{% block content %}

<div id="content">
    <h1>Welcome to tournament</h1>

    <div class="profiles-container">
    <div class="profile">
        <h2>{{ user.username }}</h2>
        <img src="{{ user.profile.avatar.url }}" alt="User Avatar" class="avatar">
        <p id = "display_name">  <strong>Display Name:</strong> {{ user.profile.display_name }}</p>
        <p><strong>Wins:</strong> {{ user.profile.wins }}</p>
        <p><strong>Losses:</strong> {{ user.profile.losses }}</p>
        <p><strong>ID:</strong> {{ user.profile.id }}</p>
        <form id = "update-tournament-name" method="POST" action="{% url 'tornament_name_user' %}">
            {% csrf_token %}
            {{ t_form.as_p }}
            <button type="submit" class="btn btn-primary">Update</button>
        </form>
    </div>
    {% if not player2 %}
    <form method="POST" action="{% url 'second_player_tournament' %}" >
        {% csrf_token %}
        <label for="username">Player 2 Username:</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Player 2 Password:</label>
        <input type="password" id="password" name="password" required>
        <button type="submit">Log in second Player</button>
    </form>
    {% endif %}
    {% if player2 %}
    <div class="profile">
        <h2>{{ player2.username }}</h2>
        <img src="{{ player2.avatar.url }}" alt="User Avatar" class="avatar">
        <p><strong>Display Name:</strong> {{ player2.display_name }}</p>
        <p><strong>Wins:</strong> {{ player2.wins }}</p>
        <p><strong>Losses:</strong> {{ player2.losses }}</p>
        <form id = "update-tournament-name-user2" method="POST" action="{% url 'tornament_name_user2' %}">
            {% csrf_token %}
            {{ t_form.as_p }}
            <button type="submit" class="btn btn-primary">Update</button>
        </form>
    </div>
    {% endif %}
    {% if not player3 %}
    <form method="POST" action="{% url 'third_player_tournament' %}" >
        {% csrf_token %}
        <label for="username">Player 3 Username:</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Player 3 Password:</label>
        <input type="password" id="password" name="password" required>
        <button type="submit">Log in third Player</button>
    </form>
    {% endif %}
    {% if player3 %}
    <div class="profile">
        <h2>{{ player3.username }}</h2>
        <img src="{{ player3.avatar.url }}" alt="User Avatar" class="avatar">
        <p><strong>Display Name:</strong> {{ player3.display_name }}</p>
        <p><strong>Wins:</strong> {{ player3.wins }}</p>
        <p><strong>Losses:</strong> {{ player3.losses }}</p>
        <form id = "update-tournament-name-user3" method="POST" action="{% url 'tornament_name_user3' %}">
            {% csrf_token %}
            {{ t_form.as_p }}
            <button type="submit" class="btn btn-primary">Update</button>
        </form>
    </div>
    {% endif %}
    {% if not player4 %}
    <form method="POST" action="{% url 'second_player_tournament' %}" >
        {% csrf_token %}
        <label for="username">Player 4 Username:</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Player 4 Password:</label>
        <input type="password" id="password" name="password" required>
        <button type="submit">Log in forth Player</button>
    </form>
    {% endif %}
    {% if player4 %}
    <div class="profile">
        <h2>{{ player4.username }}</h2>
        <img src="{{ player4.avatar.url }}" alt="User Avatar" class="avatar">
        <p><strong>Display Name:</strong> {{ player4.display_name }}</p>
        <p><strong>Wins:</strong> {{ player4.wins }}</p>
        <p><strong>Losses:</strong> {{ player4.losses }}</p>
        <form id = "update-tournament-name-user4" method="POST" action="{% url 'tornament_name_user4' %}">
            {% csrf_token %}
            {{ t_form.as_p }}
            <button type="submit" class="btn btn-primary">Update</button>
        </form>
    </div>
    {% endif %}
    <div class="menu-container">
        <div class="menu">
            <label for="player1Type">Player 1:</label>
            <select id="player1Type">
                <option value="human">Human</option>
                <option value="ai">AI</option>
            </select>
        </div>
        <div class="menu">
            <label for="player1Colour"></label>
            <select id="player1Colour">
                <option value="red">Red</option>
                <option value="green">Green</option>
                <option value="blue">Blue</option>
                <option value="orange">Orange</option>
                <option value="purple">Purple</option>
                <option value="gold">Gold</option>
                <option value="black">Black</option>
            </select>
        </div>
        <div class="menu">
            <label for="player2Colour"></label>
            <select id="player2Colour">
                <option value="green">Green</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="orange">Orange</option>
                <option value="purple">Purple</option>
                <option value="gold">Gold</option>
                <option value="black">Black</option>
            </select>
        </div>
        <div class="menu">
            <label for="player2Type">Player 2:</label>
            <select id="player2Type">
                <option value="human">Human</option>
                <option value="ai">AI</option>
            </select>
        </div>
    </div>

    <!-- Game Canvas Section -->
    <div class="game-canvas">
        <canvas id="myCanvas" width="720" height="480"></canvas>
        <button id="runButton" class="btn btn-primary">Start Game</button>
    </div>

    <div class="game-canvas">
        <canvas id="fourPlayer" width="480" height="480"></canvas>
        <button id="runButton4" class="btn btn-primary">Start 4 Player Game</button>
    </div>
</div>

<script>
document.getElementById('update-tournament-name').addEventListener('submit', function(event) {
    event.preventDefault();  // Prevent the form from submitting normally

    const formData = new FormData(this);  // Collect the form data
    console.log(formData);

    // Send the data via a POST request to your Django view
    fetch('localhost/tornament_name_user/', {
        method: 'POST',
        body: formData,  // Send the form data
        headers: {
            'X-Requested-With': 'XMLHttpRequest'  // Indicate that this is an AJAX request
        }
    })
    .then(response => response.json())  // Parse the JSON response
    .then(data => {
        if (data.success) {
            // Handle success (e.g., show a success message)
            alert(data.message);
            document.getElementById('display_name').innerText = data.new_tournament_name;
        } else {
            // Handle errors (e.g., display validation errors)
            alert('Error: ' + JSON.stringify(data.errors));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred.');
    });
});
</script>
<style>
    /* Styling */
    .profiles-container {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        margin-top: 20px;
    }
    .profile {
        width: 200px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 10px;
        text-align: center;
        background-color: #f9f9f9;
        margin: 10px;
    }
    .avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
    }
    .menu-container {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
    }
    .menu {
        margin-right: 20px;
    }
    .game-canvas {
        text-align: center;
        margin-top: 20px;
    }
    </style>
{% endblock %}